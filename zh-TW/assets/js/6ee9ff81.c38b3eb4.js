"use strict";(self.webpackChunkdocusaurus_docs=self.webpackChunkdocusaurus_docs||[]).push([[3385],{3905:(e,t,n)=>{n.d(t,{Zo:()=>o,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},o=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,o=s(e,["components","mdxType","originalType","parentName"]),k=d(n),u=r,b=k["".concat(p,".").concat(u)]||k[u]||m[u]||l;return n?a.createElement(b,i(i({ref:t},o),{},{components:n})):a.createElement(b,i({ref:t},o))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=k;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},22266:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const l={title:"SBE BBO \u63a5\u5165\u6307\u5357",sidebar_label:"SBE BBO \u63a5\u5165\u6307\u5357",sidebar_position:1},i=void 0,s={unversionedId:"v5/sbe/bbo/sbe-bbo",id:"v5/sbe/bbo/sbe-bbo",title:"SBE BBO \u63a5\u5165\u6307\u5357",description:"\u7e3d\u89bd",source:"@site/i18n/zh-TW/docusaurus-plugin-content-docs/current/v5/sbe/bbo/sbe-bbo.mdx",sourceDirName:"v5/sbe/bbo",slug:"/v5/sbe/bbo/sbe-bbo",permalink:"/docs/zh-TW/v5/sbe/bbo/sbe-bbo",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"SBE BBO \u63a5\u5165\u6307\u5357",sidebar_label:"SBE BBO \u63a5\u5165\u6307\u5357",sidebar_position:1},sidebar:"v5SideBar",previous:{title:"SBE \u57fa\u672c\u4fe1\u606f",permalink:"/docs/zh-TW/v5/sbe/sbe-basic-info"},next:{title:"SBE Level 50 \u63a5\u5165\u6307\u5357",permalink:"/docs/zh-TW/v5/sbe/level-50/sbe-level-50"}},p={},d=[{value:"\u7e3d\u89bd",id:"\u7e3d\u89bd",level:2},{value:"\u9023\u63a5",id:"\u9023\u63a5",level:2},{value:"\u8a02\u95b1\u6d41\u7a0b(JSON \u63a7\u5236 frame)",id:"\u8a02\u95b1\u6d41\u7a0bjson-\u63a7\u5236-frame",level:2},{value:"\u9001\u51fa\u8a02\u95b1\u8acb\u6c42",id:"\u9001\u51fa\u8a02\u95b1\u8acb\u6c42",level:3},{value:"\u8a02\u95b1\u78ba\u8a8d",id:"\u8a02\u95b1\u78ba\u8a8d",level:3},{value:"\u63a5\u6536\u6578\u64da",id:"\u63a5\u6536\u6578\u64da",level:3},{value:"\u89e3\u78bc\u793a\u4f8b",id:"\u89e3\u78bc\u793a\u4f8b",level:3},{value:"SBE \u4fe1\u606f\u7d50\u69cb",id:"sbe-\u4fe1\u606f\u7d50\u69cb",level:2},{value:"SBE XML Schema",id:"sbe-xml-schema",level:3},{value:"\u4fe1\u606f\u7d50\u69cb\u7d30\u7bc0",id:"\u4fe1\u606f\u7d50\u69cb\u7d30\u7bc0",level:3},{value:"\u4fe1\u606f\u6a19\u982d (8 bytes)",id:"\u4fe1\u606f\u6a19\u982d-8-bytes",level:4},{value:"\u4fe1\u606f\u4e3b\u9ad4 (<code>BestOBRpiEvent</code>)",id:"\u4fe1\u606f\u4e3b\u9ad4-bestobrpievent",level:4},{value:"\u76f8\u95dc\u512a\u5316",id:"\u76f8\u95dc\u512a\u5316",level:2},{value:"\u60c5\u6cc1 1: <code>askNormalSize != 0 &amp;&amp; askRpiSize != 0</code>",id:"\u60c5\u6cc1-1-asknormalsize--0--askrpisize--0",level:4},{value:"\u60c5\u6cc1 2: <code>askNormalSize != 0 &amp;&amp; askRpiSize == 0</code>",id:"\u60c5\u6cc1-2-asknormalsize--0--askrpisize--0",level:4},{value:"\u60c5\u6cc1 3: <code>askNormalSize == 0 &amp;&amp; askRpiSize != 0</code>",id:"\u60c5\u6cc1-3-asknormalsize--0--askrpisize--0",level:4},{value:"\u60c5\u6cc1 4",id:"\u60c5\u6cc1-4",level:4},{value:"\u63a5\u5165\u793a\u4f8b",id:"\u63a5\u5165\u793a\u4f8b",level:2}],o={toc:d};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},o,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\u7e3d\u89bd"},"\u7e3d\u89bd"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Channel:")," \u50c5\u652f\u63f4\u79c1\u6709 MMWS, \u4e0d\u958b\u653e\u65bc public WS."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Topic:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"ob.rpi.1.sbe.{symbol}"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Format:")," SBE \u4e8c\u9032\u5236 frame (",(0,r.kt)("inlineCode",{parentName:"li"},"opcode = 2"),"), little-endian."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Depth:")," \u63d0\u4f9b\u5373\u6642 Level 1 \u8a02\u55ae\u7c3f\u8cc7\u6599."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Units:")," \u6642\u9593\u6233\u70ba microseconds (\xb5s), price/size \u70ba mantissa \u642d\u914d exponent."),(0,r.kt)("li",{parentName:"ul"},"\u81ea2026\u5e741\u670815\u65e5\u8d77\uff0cSBE\u9023\u63a5\u5c07\u50c5\u80fd\u901a\u904e ",(0,r.kt)("strong",{parentName:"li"},"v5/public-sbe")," \u4f7f\u7528\u3002")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u9023\u63a5"},"\u9023\u63a5"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5c0d\u65bc linear / inverse / spot \u7684 Level 1 \u8cc7\u6599: \u5982\u679c 3 \u79d2\u5167\u8a02\u55ae\u7c3f\u6c92\u6709\u8b8a\u5316, \u6703\u518d\u6b21\u63a8\u9001 snapshot \u4fe1\u606f, \u6b04\u4f4d ",(0,r.kt)("inlineCode",{parentName:"li"},"u")," \u6703\u8207\u524d\u4e00\u5247\u4fe1\u606f\u76f8\u540c\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u6975\u7aef\u7684\u5e02\u5834\u60c5\u6cc1\u4e0b, \u7522\u751f\u7aef\u8207\u63a8\u9001\u7aef\u90fd\u6703\u63a1\u7528\u5408\u4f75\u8207\u4e1f\u5305\u7b56\u7565, \u56e0\u6b64 ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"u")," \u7684\u9023\u7e8c\u6027\u4e0d\u88ab\u4fdd\u8b49"),"\u3002")),(0,r.kt)("h2",{id:"\u8a02\u95b1\u6d41\u7a0bjson-\u63a7\u5236-frame"},"\u8a02\u95b1\u6d41\u7a0b(JSON \u63a7\u5236 frame)"),(0,r.kt)("h3",{id:"\u9001\u51fa\u8a02\u95b1\u8acb\u6c42"},"\u9001\u51fa\u8a02\u95b1\u8acb\u6c42"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "op": "subscribe",\n  "args": ["ob.rpi.1.sbe.BTCUSDT"]\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Topic \u683c\u5f0f: ",(0,r.kt)("inlineCode",{parentName:"li"},"ob.rpi.1.sbe.<symbol>")),(0,r.kt)("li",{parentName:"ul"},"\u7bc4\u4f8b symbol: ",(0,r.kt)("inlineCode",{parentName:"li"},"BTCUSDT"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"ETHUSDT")," \u7b49\u3002")),(0,r.kt)("h3",{id:"\u8a02\u95b1\u78ba\u8a8d"},"\u8a02\u95b1\u78ba\u8a8d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "success": true,\n  "ret_msg": "",\n  "conn_id": "d30fdpbboasp1pjbe7r0",\n  "req_id": "xxx",\n  "op": "subscribe"\n}\n')),(0,r.kt)("h3",{id:"\u63a5\u6536\u6578\u64da"},"\u63a5\u6536\u6578\u64da"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'b"R\\x00 N\\x01\\x00\\x00\\x00\\xdb\\x84\\xd0k\\x00\\x00\\x00\\x00f\\xb7\\x003\\x99\\x01\\x00\\x00\\x02\\x06\\xa1\\xcb\\xa1\\x00\\x00\\x00\\x00\\x00\\xe7\\xda\\x0b\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x04\\xc8\\xa1\\x00\\x00\\x00\\x00\\x00 N\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x008\\x01\\x00\\x00\\x00\\x00\\x00\\x00v\\xba\\x003\\x99\\x01\\x00\\x00\\x07BTCUSDT"\n')),(0,r.kt)("h3",{id:"\u89e3\u78bc\u793a\u4f8b"},"\u89e3\u78bc\u793a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "header": {\n    "block_length": 82,\n    "template_id": 20000,\n    "schema_id": 1,\n    "version": 0\n  },\n  "seq": 1808827611,\n  "cts": 1757497309030,\n  "price_exponent": 2,\n  "size_exponent": 6,\n  "ask_price": 1060342500,\n  "ask_normal_size": 776935000000,\n  "ask_rpi_size": 0,\n  "bid_price": 1060250000,\n  "bid_normal_size": 20000000000,\n  "bid_rpi_size": 0,\n  "u": 312,\n  "ts": 1757497309814,\n  "symbol": "BTCUSDT",\n  "parsed_length": 98\n}\n')),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"sbe-\u4fe1\u606f\u7d50\u69cb"},"SBE \u4fe1\u606f\u7d50\u69cb"),(0,r.kt)("h3",{id:"sbe-xml-schema"},"SBE XML Schema"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"templateId = 20000")," \u7528\u4f86\u8b58\u5225\u4fe1\u606f\u578b\u5225\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u9a57\u8b49 ",(0,r.kt)("inlineCode",{parentName:"li"},"templateId = 20000")," \u4ee5\u78ba\u8a8d\u9019\u662f\u4e00\u5247 Level 1 \u8a02\u55ae\u7c3f\u4e8b\u4ef6\u3002"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"../sbe-basic-info#sbe-xml-template"},"sbe xml template"))),(0,r.kt)("h3",{id:"\u4fe1\u606f\u7d50\u69cb\u7d30\u7bc0"},"\u4fe1\u606f\u7d50\u69cb\u7d30\u7bc0"),(0,r.kt)("h4",{id:"\u4fe1\u606f\u6a19\u982d-8-bytes"},"\u4fe1\u606f\u6a19\u982d (8 bytes)"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Size (bytes)"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"blockLength"),(0,r.kt)("td",{parentName:"tr",align:null},"uint16"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4fe1\u606f\u4e3b\u9ad4\u9577\u5ea6 Message body length")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"templateId"),(0,r.kt)("td",{parentName:"tr",align:null},"uint16"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fa\u5b9a\u503c = 20000 Fixed = 20000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"schemaId"),(0,r.kt)("td",{parentName:"tr",align:null},"uint16"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fa\u5b9a\u503c = 1 Fixed = 1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"version"),(0,r.kt)("td",{parentName:"tr",align:null},"uint16"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"\u56fa\u5b9a\u503c = 0 Fixed = 0")))),(0,r.kt)("h4",{id:"\u4fe1\u606f\u4e3b\u9ad4-bestobrpievent"},"\u4fe1\u606f\u4e3b\u9ad4 (",(0,r.kt)("inlineCode",{parentName:"h4"},"BestOBRpiEvent"),")"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"ID"),(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"ts"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"Snapshot \u6642\u9593\u6233 (\xb5s) Snapshot timestamp (\xb5s)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"seq"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u552f\u4e00\u4fe1\u606f\u5e8f\u865f Unique message sequence number")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"cts"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4ea4\u6613\u6642\u9593\u6233 (\xb5s) Trade timestamp (\xb5s)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"u"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u66f4\u65b0 ID Update ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"askNormalPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73\u8ce3\u50f9 mantissa Best ask price mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"6"),(0,r.kt)("td",{parentName:"tr",align:null},"askNormalSize"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73\u8ce3\u91cf (normal) mantissa Best ask size (normal) mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"7"),(0,r.kt)("td",{parentName:"tr",align:null},"askRpiPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73 RPI \u8ce3\u50f9 mantissa Best RPI ask price mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"8"),(0,r.kt)("td",{parentName:"tr",align:null},"askRpiSize"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73 RPI \u8ce3\u91cf mantissa Best RPI ask size mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"9"),(0,r.kt)("td",{parentName:"tr",align:null},"bidNormalPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73\u8cb7\u50f9 mantissa Best bid price mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10"),(0,r.kt)("td",{parentName:"tr",align:null},"bidNormalSize"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73\u8cb7\u91cf (normal) mantissa Best bid size (normal) mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"11"),(0,r.kt)("td",{parentName:"tr",align:null},"bidRpiPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73\u8cb7\u50f9 (RPI) mantissa Best bid price (RPI) mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"12"),(0,r.kt)("td",{parentName:"tr",align:null},"bidRpiSize"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6700\u4f73\u8cb7\u91cf (RPI) mantissa Best bid size (RPI) mantissa")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"13"),(0,r.kt)("td",{parentName:"tr",align:null},"priceExponent"),(0,r.kt)("td",{parentName:"tr",align:null},"int8"),(0,r.kt)("td",{parentName:"tr",align:null},"\u50f9\u683c exponent Price exponent")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"14"),(0,r.kt)("td",{parentName:"tr",align:null},"sizeExponent"),(0,r.kt)("td",{parentName:"tr",align:null},"int8"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6578\u91cf exponent Size exponent")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"55"),(0,r.kt)("td",{parentName:"tr",align:null},"symbol"),(0,r.kt)("td",{parentName:"tr",align:null},"varStr"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4ea4\u6613\u5c0d (\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"td"},"BTCUSDT"),") Trading pair (e.g., ",(0,r.kt)("inlineCode",{parentName:"td"},"BTCUSDT"),")")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u76f8\u95dc\u512a\u5316"},"\u76f8\u95dc\u512a\u5316"),(0,r.kt)("p",null,"\u65b0\u7684\u6b04\u4f4d\u5b9a\u7fa9 (\u4ee5\u8ce3\u65b9\u70ba\u4f8b, \u8cb7\u65b9\u908f\u8f2f\u76f8\u540c):"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Definition"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 No RPI order best ask price")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalSize"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf No RPI order best ask size")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 RPI order best ask price")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiSize"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf RPI order best ask size")))),(0,r.kt)("p",null,"\u76ee\u524d\u7684\u908f\u8f2f\u53ef\u80fd\u51fa\u73fe\u4ee5\u4e0b\u72c0\u6cc1:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Price"),(0,r.kt)("th",{parentName:"tr",align:null},"normalQty"),(0,r.kt)("th",{parentName:"tr",align:null},"rpiQty"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null},"100")))),(0,r.kt)("p",null,"\u9019\u8868\u793a\u6c92\u6709 RPI \u6b0a\u9650\u7684\u4f7f\u7528\u8005\u7121\u6cd5\u5f97\u77e5\u5be6\u969b\u53ef\u6210\u4ea4\u7684\u50f9\u683c, \u5c0e\u81f4\u9019\u5247\u4fe1\u606f\u5c0d\u4ed6\u5011\u6c92\u6709\u5be6\u969b\u610f\u7fa9\u3002\u70ba\u4e86\u89e3\u6c7a\u6b64\u554f\u984c, \u6211\u5011\u5c0d\u4fe1\u606f\u5167\u5bb9\u505a\u4e86\u4e0a\u8ff0\u8abf\u6574\u3002"),(0,r.kt)("h4",{id:"\u60c5\u6cc1-1-asknormalsize--0--askrpisize--0"},"\u60c5\u6cc1 1: ",(0,r.kt)("inlineCode",{parentName:"h4"},"askNormalSize != 0 && askRpiSize != 0")),(0,r.kt)("p",null,"\u9019\u662f\u57fa\u65bc\u5be6\u969b\u5e02\u5834\u60c5\u6cc1\u7684\u6b63\u5e38\u56de\u61c9, \u8207\u539f\u5148\u4fe1\u606f\u8868\u9054\u7684\u542b\u7fa9\u76f8\u540c\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Definition"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 No RPI order best ask price"),(0,r.kt)("td",{parentName:"tr",align:null},"1000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalSize"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf No RPI order best ask size"),(0,r.kt)("td",{parentName:"tr",align:null},"200")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 RPI order best ask price"),(0,r.kt)("td",{parentName:"tr",align:null},"1000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiSize"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf RPI order best ask size"),(0,r.kt)("td",{parentName:"tr",align:null},"300")))),(0,r.kt)("h4",{id:"\u60c5\u6cc1-2-asknormalsize--0--askrpisize--0"},"\u60c5\u6cc1 2: ",(0,r.kt)("inlineCode",{parentName:"h4"},"askNormalSize != 0 && askRpiSize == 0")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"askRpiPrice")," \u6703\u88ab\u6307\u5b9a\u70ba ",(0,r.kt)("inlineCode",{parentName:"p"},"askNormalPrice"),", \u4e26\u4e14 ",(0,r.kt)("inlineCode",{parentName:"p"},"askRpiSize = 0"),"\u3002",(0,r.kt)("br",{parentName:"p"}),"\n","\u5728\u6b64\u60c5\u6cc1\u4e0b, \u4e0d\u6703\u518d\u5411\u66f4\u6df1\u7684\u50f9\u4f4d\u641c\u5c0b ",(0,r.kt)("inlineCode",{parentName:"p"},"askRpiPrice"),"\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Definition"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"),(0,r.kt)("th",{parentName:"tr",align:null},"Note"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 No RPI order best ask price"),(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalSize"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf No RPI order best ask size"),(0,r.kt)("td",{parentName:"tr",align:null},"200"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 RPI order best ask price"),(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null},"This itself has no meaning. The price field is assigned a non-RPI sell price.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiSize"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf RPI order best ask size"),(0,r.kt)("td",{parentName:"tr",align:null},"0"),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("h4",{id:"\u60c5\u6cc1-3-asknormalsize--0--askrpisize--0"},"\u60c5\u6cc1 3: ",(0,r.kt)("inlineCode",{parentName:"h4"},"askNormalSize == 0 && askRpiSize != 0")),(0,r.kt)("p",null,"\u6b64\u6642 ",(0,r.kt)("inlineCode",{parentName:"p"},"askNormalPrice =")," \u771f\u6b63\u7684\u975e RPI \u6700\u4f73\u8ce3\u50f9\u3002",(0,r.kt)("br",{parentName:"p"}),"\n","\u5728\u9019\u7a2e\u60c5\u6cc1\u4e0b, \u6703\u56de\u50b3\u4e26\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"askNormalPrice"),"\u3002"),(0,r.kt)("p",null,"\u793a\u4f8b:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Definition"),(0,r.kt)("th",{parentName:"tr",align:null},"Example"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 No RPI order best ask price"),(0,r.kt)("td",{parentName:"tr",align:null},"1200")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askNormalSize"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7121 RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf No RPI order best ask size"),(0,r.kt)("td",{parentName:"tr",align:null},"100")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u50f9 RPI order best ask price"),(0,r.kt)("td",{parentName:"tr",align:null},"1000")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"askRpiSize"),(0,r.kt)("td",{parentName:"tr",align:null},"RPI \u8a02\u55ae\u7684\u6700\u4f73\u8ce3\u91cf RPI order best ask size"),(0,r.kt)("td",{parentName:"tr",align:null},"20")))),(0,r.kt)("h4",{id:"\u60c5\u6cc1-4"},"\u60c5\u6cc1 4"),(0,r.kt)("p",null,"\u7576\u5e02\u5834\u6975\u5ea6\u51b7\u6e05, \u5b8c\u5168\u6c92\u6709\u6d41\u52d5\u6027\u6642, ",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u6703\u63a8\u9001\u4efb\u4f55 BBO \u4fe1\u606f"),"\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u63a5\u5165\u793a\u4f8b"},"\u63a5\u5165\u793a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import json\nimport logging\nimport struct\nimport threading\nimport time\nfrom datetime import datetime\nfrom typing import Dict, Any\n\nimport websocket\n\nlogging.basicConfig(\n    filename="logfile_wrapper.log",\n    level=logging.INFO,\n    format="%(asctime)s %(levelname)s %(message)s",\n)\n\n# Change symbol/topic as you wish\nTOPIC = "ob.rpi.1.sbe.BTCUSDT"\nWS_URL = "wss://stream-testnet.bybits.org/v5/public-sbe/spot"\n\n\nclass SBEBestOBRpiParser:\n    """\n    Parser for BestOBRpiEvent (template_id = 20000) per XML schema:\n\n    ts(int64), seq(int64), cts(int64), u(int64),\n    askNormalPrice(int64), askNormalSize(int64),\n    askRpiPrice(int64), askRpiSize(int64),\n    bidNormalPrice(int64), bidNormalSize(int64),\n    bidRpiPrice(int64), bidRpiSize(int64),\n    priceExponent(int8), sizeExponent(int8),\n    symbol(varString8)\n\n    All values are little-endian.\n    """\n\n    def __init__(self) -> None:\n        # Header: blockLength, templateId, schemaId, version\n        self.header_fmt = "<HHHH"\n        self.header_sz = struct.calcsize(self.header_fmt)\n\n        # 12 x int64 + 2 x int8:\n        # ts, seq, cts, u,\n        # askNormalPrice, askNormalSize, askRpiPrice, askRpiSize,\n        # bidNormalPrice, bidNormalSize, bidRpiPrice, bidRpiSize,\n        # priceExponent, sizeExponent\n        self.body_fmt = "<" + ("q" * 12) + "bb"\n        self.body_sz = struct.calcsize(self.body_fmt)\n\n        self.target_template_id = 20000\n\n    def _parse_header(self, data: bytes) -> Dict[str, Any]:\n        if len(data) < self.header_sz:\n            raise ValueError("insufficient data for SBE header")\n\n        block_length, template_id, schema_id, version = struct.unpack_from(\n            self.header_fmt, data, 0\n        )\n\n        return {\n            "block_length": block_length,\n            "template_id": template_id,\n            "schema_id": schema_id,\n            "version": version,\n        }\n\n    @staticmethod\n    def _parse_varstring8(data: bytes, offset: int) -> tuple[str, int]:\n        if offset + 1 > len(data):\n            raise ValueError("insufficient data for varString8 length")\n\n        (length,) = struct.unpack_from("<B", data, offset)\n        offset += 1\n\n        if offset + length > len(data):\n            raise ValueError("insufficient data for varString8 bytes")\n\n        s = data[offset : offset + length].decode("utf-8")\n        offset += length\n        return s, offset\n\n    @staticmethod\n    def _apply_exponent(value: int, exponent: int) -> float:\n        # Exponent is for decimal point positioning.\n        # If exponent = 2 and value=1060342500 -> 10603425.00\n        return value / (10 ** exponent) if exponent >= 0 else value * (\n            10 ** (-exponent)\n        )\n\n    def parse(self, data: bytes) -> Dict[str, Any]:\n        hdr = self._parse_header(data)\n        if hdr["template_id"] != self.target_template_id:\n            raise NotImplementedError(\n                f"unsupported template_id={hdr[\'template_id\']}"\n            )\n\n        if len(data) < self.header_sz + self.body_sz:\n            raise ValueError("insufficient data for BestOBRpiEvent body")\n\n        fields = struct.unpack_from(self.body_fmt, data, self.header_sz)\n        (\n            ts,\n            seq,\n            cts,\n            u,\n            ask_np_m,\n            ask_ns_m,\n            ask_rp_m,\n            ask_rs_m,\n            bid_np_m,\n            bid_ns_m,\n            bid_rp_m,\n            bid_rs_m,\n            price_exp,\n            size_exp,\n        ) = fields\n\n        offset = self.header_sz + self.body_sz\n        symbol, offset = self._parse_varstring8(data, offset)\n\n        # Apply exponents\n        ask_np = self._apply_exponent(ask_np_m, price_exp)\n        ask_ns = self._apply_exponent(ask_ns_m, size_exp)\n        ask_rp = self._apply_exponent(ask_rp_m, price_exp)\n        ask_rs = self._apply_exponent(ask_rs_m, size_exp)\n        bid_np = self._apply_exponent(bid_np_m, price_exp)\n        bid_ns = self._apply_exponent(bid_ns_m, size_exp)\n        bid_rp = self._apply_exponent(bid_rp_m, price_exp)\n        bid_rs = self._apply_exponent(bid_rs_m, size_exp)\n\n        return {\n            "header": hdr,\n            "ts": ts,\n            "seq": seq,\n            "cts": cts,\n            "u": u,\n            "price_exponent": price_exp,\n            "size_exponent": size_exp,\n            "symbol": symbol,\n            # Normal book (best)\n            "ask_normal_price": ask_np,\n            "ask_normal_size": ask_ns,\n            "bid_normal_price": bid_np,\n            "bid_normal_size": bid_ns,\n            # RPI book (best)\n            "ask_rpi_price": ask_rp,\n            "ask_rpi_size": ask_rs,\n            "bid_rpi_price": bid_rp,\n            "bid_rpi_size": bid_rs,\n            "parsed_length": offset,\n        }\n\n\nparser = SBEBestOBRpiParser()\n\n\n# --------------------------- WebSocket handlers ---------------------------\n\ndef on_message(ws, message):\n    try:\n        # Binary SBE frames; text frames for control/acks/errors\n        if isinstance(message, (bytes, bytearray)):\n            decoded = parser.parse(message)\n            logging.info(\n                "SBE %s seq=%s u=%s "\n                "NORM bid=%.8f@%.8f ask=%.8f@%.8f "\n                "RPI bid=%.8f@%.8f ask=%.8f@%.8f ts=%s",\n                decoded["symbol"],\n                decoded["seq"],\n                decoded["u"],\n                decoded["bid_normal_price"],\n                decoded["bid_normal_size"],\n                decoded["ask_normal_price"],\n                decoded["ask_normal_size"],\n                decoded["bid_rpi_price"],\n                decoded["bid_rpi_size"],\n                decoded["ask_rpi_price"],\n                decoded["ask_rpi_size"],\n                decoded["ts"],\n            )\n            print(\n                f"{decoded[\'symbol\']} u={decoded[\'u\']} "\n                f"NORM: {decoded[\'bid_normal_price\']:.8f} x {decoded[\'bid_normal_size\']:.8f} "\n                f"| {decoded[\'ask_normal_price\']:.8f} x {decoded[\'ask_normal_size\']:.8f} "\n                f"RPI: {decoded[\'bid_rpi_price\']:.8f} x {decoded[\'bid_rpi_size\']:.8f} "\n                f"| {decoded[\'ask_rpi_price\']:.8f} x {decoded[\'ask_rpi_size\']:.8f} "\n                f"(seq={decoded[\'seq\']} ts={decoded[\'ts\']})"\n            )\n        else:\n            try:\n                obj = json.loads(message)\n                logging.info("TEXT %s", obj)\n                print(obj)\n            except json.JSONDecodeError:\n                logging.warning("non-JSON text frame: %r", message)\n    except Exception as e:\n        logging.exception("decode error: %s", e)\n        print("decode error:", e)\n\n\ndef on_error(ws, error):\n    print("WS error:", error)\n    logging.error("WS error: %s", error)\n\n\ndef on_close(ws, *_):\n    print("### connection closed ###")\n    logging.info("connection closed")\n\n\ndef on_open(ws):\n    print("opened")\n    sub = {"op": "subscribe", "args": [TOPIC]}\n    ws.send(json.dumps(sub))\n    print("subscribed:", TOPIC)\n\n    threading.Thread(target=ping_per, args=(ws,), daemon=True).start()\n    threading.Thread(target=manage_subscription, args=(ws,), daemon=True).start()\n\n\ndef manage_subscription(ws):\n    # demo: unsubscribe/resubscribe once\n    time.sleep(20)\n    ws.send(json.dumps({"op": "unsubscribe", "args": [TOPIC]}))\n    print("unsubscribed:", TOPIC)\n    time.sleep(5)\n    ws.send(json.dumps({"op": "subscribe", "args": [TOPIC]}))\n    print("resubscribed:", TOPIC)\n\n\ndef ping_per(ws):\n    while True:\n        try:\n            ws.send(json.dumps({"op": "ping"}))\n        except Exception:\n            return\n        time.sleep(10)\n\n\ndef on_pong(ws, *_):\n    print("pong received")\n\n\ndef on_ping(ws, *_):\n    print("ping received @", datetime.now().strftime("%Y-%m-%d %H:%M:%S"))\n\n\ndef connWS():\n    ws = websocket.WebSocketApp(\n        WS_URL,\n        on_open=on_open,\n        on_message=on_message,\n        on_error=on_error,\n        on_close=on_close,\n        on_ping=on_ping,\n        on_pong=on_pong,\n    )\n    ws.run_forever(ping_interval=20, ping_timeout=10)\n\n\nif __name__ == "__main__":\n    websocket.enableTrace(False)\n    connWS()\n')))}m.isMDXComponent=!0}}]);