"use strict";(self.webpackChunkdocusaurus_docs=self.webpackChunkdocusaurus_docs||[]).push([[4227],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>k});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),p=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=p(e.components);return a.createElement(o.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(t),k=r,g=u["".concat(o,".").concat(k)]||u[k]||m[k]||i;return t?a.createElement(g,l(l({ref:n},d),{},{components:t})):a.createElement(g,l({ref:n},d))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=u;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},75642:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const i={title:"SBE Level 50 \u63a5\u5165\u6307\u5357",sidebar_label:"SBE Level 50 \u63a5\u5165\u6307\u5357",sidebar_position:1},l=void 0,s={unversionedId:"v5/sbe/level-50/sbe-level-50",id:"v5/sbe/level-50/sbe-level-50",title:"SBE Level 50 \u63a5\u5165\u6307\u5357",description:"\u7e3d\u89bd",source:"@site/i18n/zh-TW/docusaurus-plugin-content-docs/current/v5/sbe/level-50/sbe-level-50.mdx",sourceDirName:"v5/sbe/level-50",slug:"/v5/sbe/level-50/sbe-level-50",permalink:"/docs/zh-TW/v5/sbe/level-50/sbe-level-50",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"SBE Level 50 \u63a5\u5165\u6307\u5357",sidebar_label:"SBE Level 50 \u63a5\u5165\u6307\u5357",sidebar_position:1},sidebar:"v5SideBar",previous:{title:"SBE BBO \u63a5\u5165\u6307\u5357",permalink:"/docs/zh-TW/v5/sbe/bbo/sbe-bbo"},next:{title:"SBE Public Trade \u63a5\u5165\u6307\u5357",permalink:"/docs/zh-TW/v5/sbe/sbe-public-trade/"}},o={},p=[{value:"\u7e3d\u89bd",id:"\u7e3d\u89bd",level:2},{value:"SBE \u9023\u63a5\u6578\u9650\u5236",id:"sbe-\u9023\u63a5\u6578\u9650\u5236",level:2},{value:"\u6d41\u7a0b",id:"\u6d41\u7a0b",level:2},{value:"Ping / Pong (JSON \u63a7\u5236 frame)",id:"ping--pong-json-\u63a7\u5236-frame",level:3},{value:"\u8a02\u95b1",id:"\u8a02\u95b1",level:3},{value:"SBE XML \u6a21\u677f (L50 OB)",id:"sbe-xml-\u6a21\u677f-l50-ob",level:2},{value:"SBE Level 50 \u6b04\u4f4d\u53c3\u8003",id:"sbe-level-50-\u6b04\u4f4d\u53c3\u8003",level:2},{value:"Asks Group",id:"asks-group",level:3},{value:"Bids Group",id:"bids-group",level:3},{value:"OrderBook \u66f4\u65b0\u908f\u8f2f",id:"orderbook-\u66f4\u65b0\u908f\u8f2f",level:2},{value:"<code>u</code> (Update ID) \u6b04\u4f4d\u898f\u5247",id:"u-update-id-\u6b04\u4f4d\u898f\u5247",level:3},{value:"<code>u</code> \u7684\u884c\u70ba",id:"u-\u7684\u884c\u70ba",level:4},{value:"\u9023\u7e8c\u6027\u6aa2\u67e5",id:"\u9023\u7e8c\u6027\u6aa2\u67e5",level:4},{value:"OrderBook \u7dad\u8b77\u898f\u5247",id:"orderbook-\u7dad\u8b77\u898f\u5247",level:3},{value:"\u9996\u6b21\u9023\u7d50\u8207\u91cd\u9023",id:"\u9996\u6b21\u9023\u7d50\u8207\u91cd\u9023",level:4},{value:"\u5feb\u7167\u8655\u7406",id:"\u5feb\u7167\u8655\u7406",level:4},{value:"\u589e\u91cf\u8655\u7406",id:"\u589e\u91cf\u8655\u7406",level:4},{value:"\u63a8\u9001\u66f4\u65b0\u793a\u4f8b",id:"\u63a8\u9001\u66f4\u65b0\u793a\u4f8b",level:3},{value:"\u63a5\u5165\u793a\u4f8b",id:"\u63a5\u5165\u793a\u4f8b",level:2},{value:"Python",id:"python",level:3},{value:"Golang",id:"golang",level:3}],d={toc:p};function m(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\u7e3d\u89bd"},"\u7e3d\u89bd"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Channel:")," \u50c5\u652f\u63f4MMWS\u57df\u540d"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Topic:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"ob.50.sbe.{symbol}")," (\u6bcf 20 ms \u63a8\u9001 snapshot \u6216 delta)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Format:")," SBE \u4e8c\u9032\u5236 frame (",(0,r.kt)("inlineCode",{parentName:"li"},"opcode = 2"),"), little-endian."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Depth:")," \u6bcf\u4e00\u5074 50 \u6a94\u6df1\u5ea6, \u6b64\u983b\u9053\u5167\u4e0d\u5305\u542b RPI."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Units:")," \u6642\u9593\u6233\u70ba microseconds (\xb5s), price/size \u70ba mantissa \u642d\u914d exponent.")),(0,r.kt)("h2",{id:"sbe-\u9023\u63a5\u6578\u9650\u5236"},"SBE \u9023\u63a5\u6578\u9650\u5236"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u73fe\u8ca8:")," \u6bcf\u500b\u5c08\u5c6c MMWS host \u9650\u5236 1500 \u689d\u9023\u63a5."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u5408\u7d04 (linear + inverse):")," \u6bcf\u500b\u5c08\u5c6c MMWS host \u9650\u5236 3000 \u689d\u9023\u63a5."),(0,r.kt)("li",{parentName:"ul"},"\u4e00\u65e6\u8d85\u904e\u9023\u63a5\u4e0a\u9650, \u65b0\u9023\u63a5\u6703\u8fd4\u56de ",(0,r.kt)("strong",{parentName:"li"},"HTTP 429"),"\u3002")),(0,r.kt)("h2",{id:"\u6d41\u7a0b"},"\u6d41\u7a0b"),(0,r.kt)("h3",{id:"ping--pong-json-\u63a7\u5236-frame"},"Ping / Pong (JSON \u63a7\u5236 frame)"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Send Ping")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{"req_id": "100001", "op": "ping"}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Receive Pong")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{"success": true,"ret_msg": "pong","conn_id": "xxxxx-xx","req_id": "","op": "ping"}\n')),(0,r.kt)("h3",{id:"\u8a02\u95b1"},"\u8a02\u95b1"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Topic \u683c\u5f0f: ",(0,r.kt)("inlineCode",{parentName:"li"},"ob.50.sbe.<symbol>"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u8a02\u95b1\u793a\u4f8b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{"op": "subscribe", "args": ["ob.50.sbe.BTCUSDT"]}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u8a02\u95b1\u56de\u5831")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{"success": true,"ret_msg": "","conn_id": "d30fdpbboasp1pjbe7r0","req_id": "xxx","op": "subscribe"}\n')),(0,r.kt)("h2",{id:"sbe-xml-\u6a21\u677f-l50-ob"},"SBE XML \u6a21\u677f (L50 OB)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<sbe:messageSchema xmlns:sbe="http://fixprotocol.io/2016/sbe"\n                   xmlns:mbx="https://bybit-exchange.github.io/docs/v5/intro"\n                   package="quote.sbe"\n                   id="1"\n                   version="0"\n                   semanticVersion="1.0.0"\n                   description="Bybit market data streams SBE message schema"\n                   byteOrder="littleEndian"\n                   headerType="messageHeader">\n  <types>\n    <composite name="messageHeader" description="Template ID and length of message root">\n      <type name="blockLength" primitiveType="uint16"/>\n      <type name="templateId" primitiveType="uint16"/>\n      <type name="schemaId" primitiveType="uint16"/>\n      <type name="version" primitiveType="uint16"/>\n    </composite>\n\n    <composite name="varString8" description="Variable length UTF-8 string.">\n      <type name="length" primitiveType="uint8"/>\n      <type name="varData" length="0" primitiveType="uint8" semanticType="String" characterEncoding="UTF-8"/>\n    </composite>\n\n    <composite name="groupSize16Encoding" description="Repeating group dimensions.">\n      <type name="blockLength" primitiveType="uint16"/>\n      <type name="numInGroup" primitiveType="uint16"/>\n    </composite>\n\n    \x3c!-- NEW: package type enum --\x3e\n    <enum name="pkgTypeEnum" encodingType="uint8">\n      <validValue name="SNAPSHOT">0</validValue>\n      <validValue name="DELTA">1</validValue>\n    </enum>\n  </types>\n\n  \x3c!-- Stream event for "ob.rpi.1.sbe.<symbol>" channel --\x3e\n  <sbe:message name="BestOBRpiEvent" id="20000">\n    <field id="1"  name="ts"             type="int64" description="The timestamp in microseconds that the system generates the data"/>\n    <field id="2"  name="seq"            type="int64" description="Cross sequence ID"/>\n    <field id="3"  name="cts"            type="int64" description="The timestamp in microseconds from the matching engine when this orderbook data is produced."/>\n    <field id="4"  name="u"              type="int64" description="Update Id"/>\n    <field id="5"  name="askNormalPrice" type="int64" mbx:exponent="priceExponent" description="Mantissa for the best ask normal price"/>\n    <field id="6"  name="askNormalSize"  type="int64" mbx:exponent="sizeExponent" description="Mantissa for the best ask normal size"/>\n    <field id="7"  name="askRpiPrice"    type="int64" mbx:exponent="priceExponent" description="Mantissa for the best ask rpi price"/>\n    <field id="8"  name="askRpiSize"     type="int64" mbx:exponent="sizeExponent" description="Mantissa for the best ask rpi size"/>\n    <field id="9"  name="bidNormalPrice" type="int64" mbx:exponent="priceExponent" description="Mantissa for the best bid normal price"/>\n    <field id="10" name="bidNormalSize"  type="int64" mbx:exponent="sizeExponent" description="Mantissa for the best bid normal size"/>\n    <field id="11" name="bidRpiPrice"    type="int64" mbx:exponent="priceExponent" description="Mantissa for the best bid rpi price"/>\n    <field id="12" name="bidRpiSize"     type="int64" mbx:exponent="sizeExponent" description="Mantissa for the best bid rpi size"/>\n    <field id="13" name="priceExponent"  type="int8"  description="Price exponent for decimal point positioning"/>\n    <field id="14" name="sizeExponent"   type="int8"  description="Size exponent for decimal point positioning"/>\n    <data  id="55" name="symbol"         type="varString8"/>\n  </sbe:message>\n\n  \x3c!-- Stream event for "ob.50.sbe.<symbol>" channel --\x3e\n  <sbe:message name="OBL50Event" id="20001">\n    <field id="1"  name="ts"            type="int64" description="The timestamp in microseconds that the system generates the data"/>\n    <field id="2"  name="seq"           type="int64" description="Cross sequence ID"/>\n    <field id="3"  name="cts"           type="int64" description="The timestamp in microseconds from the matching engine when this orderbook data is produced."/>\n    <field id="4"  name="u"             type="int64" description="Update Id"/>\n    <field id="5"  name="priceExponent" type="int8"  description="Price exponent for decimal point positioning"/>\n    <field id="6"  name="sizeExponent"  type="int8"  description="Size exponent for decimal point positioning"/>\n    \x3c!-- NEW: package type --\x3e\n    <field id="7"  name="pkgType"       type="pkgTypeEnum" description="Package type: 0 = SNAPSHOT (full book), 1 = DELTA (partial update)"/>\n\n    <group id="40" name="asks" dimensionType="groupSize16Encoding" description="Sell side order book updates">\n      <field id="1" name="price" type="int64" description="Price mantissa"/>\n      <field id="2" name="size"  type="int64" description="Size mantissa"/>\n    </group>\n\n    <group id="41" name="bids" dimensionType="groupSize16Encoding" description="Buy side order book updates">\n      <field id="1" name="price" type="int64" description="Price mantissa"/>\n      <field id="2" name="size"  type="int64" description="Size mantissa"/>\n    </group>\n\n    <data id="55" name="symbol" type="varString8"/>\n  </sbe:message>\n</sbe:messageSchema>\n')),(0,r.kt)("h2",{id:"sbe-level-50-\u6b04\u4f4d\u53c3\u8003"},"SBE Level 50 \u6b04\u4f4d\u53c3\u8003"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Message:")," ",(0,r.kt)("inlineCode",{parentName:"p"},"OBL50Event")," (id = 20001)"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field Name"),(0,r.kt)("th",{parentName:"tr",align:null},"ID"),(0,r.kt)("th",{parentName:"tr",align:null},"SBE Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Unit / Format"),(0,r.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ts"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\xb5s"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7cfb\u7d71\u5728\u63a8\u9001\u5074\u751f\u6210\u8cc7\u6599\u7684\u6642\u9593\u6233 (dispatcher).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"seq"),(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"integer"),(0,r.kt)("td",{parentName:"tr",align:null},"Cross-sequence id, \u6bcf\u500b feed \u55ae\u8abf\u905e\u589e, \u4f46\u4e0d\u4fdd\u8b49\u9023\u7e8c.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"cts"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\xb5s"),(0,r.kt)("td",{parentName:"tr",align:null},"\u64ae\u5408\u5f15\u64ce\u751f\u6210\u6b64 OB snapshot \u6216 delta \u7684\u6642\u9593\u6233, \u53ef\u7528\u65bc\u5ef6\u9072\u6e2c\u91cf.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"u"),(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"integer"),(0,r.kt)("td",{parentName:"tr",align:null},"Update id, \u6bcf\u500b symbol \u55ae\u8abf\u905e\u589e, \u7528\u65bc\u6aa2\u67e5\u9023\u7e8c\u6027.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"priceExponent"),(0,r.kt)("td",{parentName:"tr",align:null},"5"),(0,r.kt)("td",{parentName:"tr",align:null},"int8"),(0,r.kt)("td",{parentName:"tr",align:null},"exponent"),(0,r.kt)("td",{parentName:"tr",align:null},"\u50f9\u683c\u5c0f\u6578\u4f4d\u6578, \u986f\u793a\u50f9\u683c = mantissa \xd7 10^",(0,r.kt)("inlineCode",{parentName:"td"},"priceExponent"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sizeExponent"),(0,r.kt)("td",{parentName:"tr",align:null},"6"),(0,r.kt)("td",{parentName:"tr",align:null},"int8"),(0,r.kt)("td",{parentName:"tr",align:null},"exponent"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6578\u91cf\u5c0f\u6578\u4f4d\u6578, \u986f\u793a\u6578\u91cf = mantissa \xd7 10^",(0,r.kt)("inlineCode",{parentName:"td"},"sizeExponent"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"pkgType"),(0,r.kt)("td",{parentName:"tr",align:null},"7"),(0,r.kt)("td",{parentName:"tr",align:null},"uint8 (",(0,r.kt)("inlineCode",{parentName:"td"},"pkgTypeEnum"),")"),(0,r.kt)("td",{parentName:"tr",align:null},"integer"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5c01\u5305\u578b\u5225 (0 = snapshot, 1 = delta).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"asks"),(0,r.kt)("td",{parentName:"tr",align:null},"40"),(0,r.kt)("td",{parentName:"tr",align:null},"group(",(0,r.kt)("inlineCode",{parentName:"td"},"groupSize16Encoding"),")"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2014"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8ce3\u65b9 order book \u66f4\u65b0, \u6700\u591a 50 \u6a94.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"bids"),(0,r.kt)("td",{parentName:"tr",align:null},"41"),(0,r.kt)("td",{parentName:"tr",align:null},"group(",(0,r.kt)("inlineCode",{parentName:"td"},"groupSize16Encoding"),")"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2014"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8cb7\u65b9 order book \u66f4\u65b0, \u6700\u591a 50 \u6a94.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"symbol"),(0,r.kt)("td",{parentName:"tr",align:null},"55"),(0,r.kt)("td",{parentName:"tr",align:null},"varString8"),(0,r.kt)("td",{parentName:"tr",align:null},"UTF-8"),(0,r.kt)("td",{parentName:"tr",align:null},"1 \u4f4d\u9577\u5ea6 byte + \u5be6\u969b\u8cc7\u6599, \u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"td"},'0x07 "BTCUSDT"'),".")))),(0,r.kt)("h3",{id:"asks-group"},"Asks Group"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field (id)"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"price (1)"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8ce3\u50f9 mantissa, \u986f\u793a\u50f9\u683c = ",(0,r.kt)("inlineCode",{parentName:"td"},"price \xd7 10^priceExponent"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"size  (2)"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8ce3\u91cf mantissa, \u986f\u793a\u6578\u91cf = ",(0,r.kt)("inlineCode",{parentName:"td"},"size \xd7 10^sizeExponent"),".")))),(0,r.kt)("h3",{id:"bids-group"},"Bids Group"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field (id)"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"price (1)"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8cb7\u50f9 mantissa, \u986f\u793a\u50f9\u683c = ",(0,r.kt)("inlineCode",{parentName:"td"},"price \xd7 10^priceExponent"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"size  (2)"),(0,r.kt)("td",{parentName:"tr",align:null},"int64"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8cb7\u91cf mantissa, \u986f\u793a\u6578\u91cf = ",(0,r.kt)("inlineCode",{parentName:"td"},"size \xd7 10^sizeExponent"),".")))),(0,r.kt)("h2",{id:"orderbook-\u66f4\u65b0\u908f\u8f2f"},"OrderBook \u66f4\u65b0\u908f\u8f2f"),(0,r.kt)("h3",{id:"u-update-id-\u6b04\u4f4d\u898f\u5247"},(0,r.kt)("inlineCode",{parentName:"h3"},"u")," (Update ID) \u6b04\u4f4d\u898f\u5247"),(0,r.kt)("h4",{id:"u-\u7684\u884c\u70ba"},(0,r.kt)("inlineCode",{parentName:"h4"},"u")," \u7684\u884c\u70ba"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6b04\u4f4d ",(0,r.kt)("inlineCode",{parentName:"li"},"u")," \u7e3d\u662f",(0,r.kt)("strong",{parentName:"li"},"\u55ae\u8abf\u905e\u589e"),"."),(0,r.kt)("li",{parentName:"ul"},"\u6b04\u4f4d ",(0,r.kt)("inlineCode",{parentName:"li"},"u")," \u901a\u5e38",(0,r.kt)("strong",{parentName:"li"},"\u4e0d\u6703\u91cd\u7f6e"),", \u9664\u975e\u7cfb\u7d71\u91cd\u555f\u6216\u7cbe\u5ea6 (precision) \u6539\u8b8a."),(0,r.kt)("li",{parentName:"ul"},"\u7576 ",(0,r.kt)("inlineCode",{parentName:"li"},"u = 1")," \u6642\u6c38\u9060\u4ee3\u8868\u4e00\u500b ",(0,r.kt)("strong",{parentName:"li"},"snapshot"))),(0,r.kt)("h4",{id:"\u9023\u7e8c\u6027\u6aa2\u67e5"},"\u9023\u7e8c\u6027\u6aa2\u67e5"),(0,r.kt)("p",null,"\u53ea\u6709\u5728 ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"u != 1"))," \u6642\u624d\u9700\u8981\u9032\u884c\u9023\u7e8c\u6027\u6aa2\u67e5."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Condition"),(0,r.kt)("th",{parentName:"tr",align:null},"Action"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"u != 1")),(0,r.kt)("td",{parentName:"tr",align:null},"\u9a57\u8b49\u9023\u7e8c\u6027: \u4e0b\u4e00\u500b ",(0,r.kt)("inlineCode",{parentName:"td"},"u")," \u61c9\u8a72\u7b49\u65bc\u524d\u4e00\u500b ",(0,r.kt)("inlineCode",{parentName:"td"},"u + 1"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"u == 1")),(0,r.kt)("td",{parentName:"tr",align:null},"\u7279\u6b8a snapshot (\u670d\u52d9\u91cd\u555f\u6216\u7cbe\u5ea6\u8b8a\u66f4), ",(0,r.kt)("strong",{parentName:"td"},"\u4e0d\u61c9")," \u57f7\u884c\u9023\u7e8c\u6027\u6aa2\u67e5.")))),(0,r.kt)("h3",{id:"orderbook-\u7dad\u8b77\u898f\u5247"},"OrderBook \u7dad\u8b77\u898f\u5247"),(0,r.kt)("h4",{id:"\u9996\u6b21\u9023\u7d50\u8207\u91cd\u9023"},"\u9996\u6b21\u9023\u7d50\u8207\u91cd\u9023"),(0,r.kt)("p",null,"\u8a02\u95b1\u5b8c\u6210\u5f8c, ",(0,r.kt)("strong",{parentName:"p"},"\u7b2c\u4e00\u689d\u4fe1\u606f\u4e00\u5b9a\u662f snapshot"),", \u5ba2\u6236\u7aef\u4f7f\u7528\u8a72 snapshot \u521d\u59cb\u5316\u672c\u5730 orderbook."),(0,r.kt)("h4",{id:"\u5feb\u7167\u8655\u7406"},"\u5feb\u7167\u8655\u7406"),(0,r.kt)("p",null,"\u6536\u5230Snapshot \u4e00\u5b9a\u8981 ",(0,r.kt)("strong",{parentName:"p"},"\u5b8c\u5168\u53d6\u4ee3")," \u672c\u5730 orderbook"),(0,r.kt)("p",null,"Snapshot \u53ef\u80fd\u51fa\u73fe\u65bc:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u8a02\u95b1\u4e4b\u5f8c"),(0,r.kt)("li",{parentName:"ul"},"\u7576\u55ae\u6b21\u8b8a\u66f4\u7684\u50f9\u4f4d\u6578\u8d85\u904e 100 \u6a94 (\u6975\u7aef\u884c\u60c5\u81ea\u52d5\u56de\u9000\u6a5f\u5236)"),(0,r.kt)("li",{parentName:"ul"},"\u5167\u90e8\u670d\u52d9\u91cd\u555f\u4e4b\u5f8c"),(0,r.kt)("li",{parentName:"ul"},"exponent / precision \u8b8a\u66f4\u4e4b\u5f8c")),(0,r.kt)("h4",{id:"\u589e\u91cf\u8655\u7406"},"\u589e\u91cf\u8655\u7406"),(0,r.kt)("p",null,"Delta \u4ee5 ",(0,r.kt)("strong",{parentName:"p"},"\u589e\u91cf\u65b9\u5f0f")," \u5957\u7528:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7576 ",(0,r.kt)("inlineCode",{parentName:"li"},"size > 0")," \u6642\u63d2\u5165\u6216\u66f4\u65b0\u5c0d\u61c9\u50f9\u4f4d,\u7576 ",(0,r.kt)("inlineCode",{parentName:"li"},"size == 0")," \u6642\u522a\u9664\u5c0d\u61c9\u50f9\u4f4d,\u6301\u7e8c\u4f7f\u7528\u6b04\u4f4d ",(0,r.kt)("inlineCode",{parentName:"li"},"u")," \u9032\u884c\u9023\u7e8c\u6027\u6aa2\u67e5.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6975\u7aef\u884c\u60c5\u8655\u7406")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7576\u67d0\u4e00\u7b46 delta \u5305\u542b ",(0,r.kt)("strong",{parentName:"li"},"\u8d85\u904e 100 \u6a94 bid+ask \u66f4\u65b0")," (\u8cb7\u8ce3\u52a0\u7e3d), \u7cfb\u7d71\u6703\u81ea\u52d5\u6539\u70ba\u63a8\u9001 ",(0,r.kt)("strong",{parentName:"li"},"\u5b8c\u6574 snapshot"),", \u4e0d\u518d\u63a8\u9001\u8a72\u7b46 delta."),(0,r.kt)("li",{parentName:"ul"},"\u78ba\u4fdd\u5ba2\u6236\u7aef orderbook \u80fd\u5920\u4e7e\u6de8\u5730\u91cd\u65b0\u540c\u6b65."),(0,r.kt)("li",{parentName:"ul"},"\u907f\u514d\u5728\u9ad8\u983b\u8b8a\u52d5\u6642\u7522\u751f\u5927\u91cf delta \u5c01\u5305."),(0,r.kt)("li",{parentName:"ul"},"Snapshot \u5927\u5c0f\u56fa\u5b9a, \u89e3\u78bc\u884c\u70ba\u66f4\u53ef\u9810\u671f.")),(0,r.kt)("h3",{id:"\u63a8\u9001\u66f4\u65b0\u793a\u4f8b"},"\u63a8\u9001\u66f4\u65b0\u793a\u4f8b"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f\u771f\u5be6\u60c5\u5883, \u9023\u63a5\u7a69\u5b9a\u4e14\u4fe1\u606f\u6309\u9806\u5e8f\u5230\u9054:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"u"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Notes"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10000"),(0,r.kt)("td",{parentName:"tr",align:null},"snapshot"),(0,r.kt)("td",{parentName:"tr",align:null},"\u8a02\u95b1\u5f8c\u6536\u5230\u7684\u7b2c\u4e00\u5247\u4fe1\u606f.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10001"),(0,r.kt)("td",{parentName:"tr",align:null},"delta"),(0,r.kt)("td",{parentName:"tr",align:null},"\u589e\u91cf\u66f4\u65b0, \u5fc5\u9808 ",(0,r.kt)("strong",{parentName:"td"},"\u5c07\u8b8a\u66f4\u5957\u7528")," \u5728\u73fe\u6709\u672c\u5730 orderbook \u4e0a.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10002"),(0,r.kt)("td",{parentName:"tr",align:null},"delta"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6b63\u5e38\u7684\u589e\u91cf\u66f4\u65b0.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10003"),(0,r.kt)("td",{parentName:"tr",align:null},"snapshot"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5e02\u5834\u5927\u5e45\u6ce2\u52d5, \u8b8a\u66f4\u50f9\u4f4d\u6578 > 100, \u7cfb\u7d71\u6539\u4ee5 snapshot \u63a8\u9001\u4e26 ",(0,r.kt)("strong",{parentName:"td"},"\u91cd\u5efa")," \u672c\u5730 orderbook.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"10004"),(0,r.kt)("td",{parentName:"tr",align:null},"delta"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5f9e\u6700\u65b0 snapshot \u7e7c\u7e8c\u63a8\u9001 delta.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"snapshot"),(0,r.kt)("td",{parentName:"tr",align:null},"\u670d\u52d9\u91cd\u555f\u6216\u7cbe\u5ea6\u8b8a\u66f4, \u5c0e\u81f4 ",(0,r.kt)("inlineCode",{parentName:"td"},"u")," \u91cd\u8a2d\u70ba 1.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2"),(0,r.kt)("td",{parentName:"tr",align:null},"delta"),(0,r.kt)("td",{parentName:"tr",align:null},"\u65b0\u4e00\u8f2a\u9023\u7e8c\u5e8f\u5217\u7684\u958b\u59cb.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"delta"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2014")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4"),(0,r.kt)("td",{parentName:"tr",align:null},"delta"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2014")))),(0,r.kt)("h2",{id:"\u63a5\u5165\u793a\u4f8b"},"\u63a5\u5165\u793a\u4f8b"),(0,r.kt)("h3",{id:"python"},"Python"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import json\nimport logging\nimport struct\nimport threading\nimport time\nfrom datetime import datetime\nfrom typing import Dict, Any, List, Tuple\n\nimport websocket\n\nlogging.basicConfig(\n    filename=\'logfile_ob50.log\',\n    level=logging.INFO,\n    format=\'%(asctime)s %(levelname)s %(message)s\'\n)\n\n# -------------------------------------------------------------------\n# Config\n# -------------------------------------------------------------------\n\n# L50 SBE order book topic\nTOPIC = "ob.50.sbe.BTCUSDT"\n\n# Adjust URL for spot / contract environment as needed:\nWS_URL = "wss://stream-testnet.bybits.org/v5/public-sbe/spot"\n\n# -------------------------------------------------------------------\n# SBE Parser for OBL50Event (template_id = 20001)\n#\n# XML schema:\n#   ts(int64), seq(int64), cts(int64), u(int64),\n#   priceExponent(int8), sizeExponent(int8),\n#   pkgType(uint8)   # 0 = SNAPSHOT, 1 = DELTA\n#   group asks: blockLen(uint16), numInGroup(uint16),\n#               then numInGroup * [ price(int64), size(int64) ]\n#   group bids: same as asks\n#   symbol(varString8)\n# -------------------------------------------------------------------\n\nclass SBEOBL50Parser:\n    def __init__(self):\n        # message header: blockLength, templateId, schemaId, version\n        self.header_fmt = "<HHHH"\n        self.header_sz = struct.calcsize(self.header_fmt)\n\n        # fixed body fields:\n        # ts, seq, cts, u   -> 4 x int64\n        # priceExponent, sizeExponent -> 2 x int8\n        # pkgType -> uint8\n        self.body_fmt = "<qqqqbbB"   # 4*q + 2*b + B\n        self.body_sz = struct.calcsize(self.body_fmt)\n\n        # group header for repeating groups: blockLength(uint16), numInGroup(uint16)\n        self.group_hdr_fmt = "<HH"\n        self.group_hdr_sz = struct.calcsize(self.group_hdr_fmt)\n\n        # each group entry: price(int64), size(int64)\n        self.level_fmt = "<qq"\n        self.level_sz = struct.calcsize(self.level_fmt)\n\n        self.target_template_id = 20001\n\n    # ---------------- core small helpers ----------------\n\n    def _parse_header(self, data: bytes) -> Dict[str, Any]:\n        if len(data) < self.header_sz:\n            raise ValueError("insufficient data for SBE header")\n        block_length, template_id, schema_id, version = struct.unpack_from(\n            self.header_fmt, data, 0\n        )\n        return {\n            "block_length": block_length,\n            "template_id": template_id,\n            "schema_id": schema_id,\n            "version": version,\n        }\n\n    @staticmethod\n    def _parse_varstring8(data: bytes, offset: int) -> Tuple[str, int]:\n        if offset + 1 > len(data):\n            raise ValueError("insufficient data for varString8 length")\n        (length,) = struct.unpack_from("<B", data, offset)\n        offset += 1\n        if length == 0:\n            return "", offset\n        if offset + length > len(data):\n            raise ValueError("insufficient data for varString8 bytes")\n        s = data[offset: offset + length].decode("utf-8")\n        offset += length\n        return s, offset\n\n    @staticmethod\n    def _apply_exponent(value: int, exponent: int) -> float:\n        return value / (10 ** exponent) if exponent >= 0 else value * (10 ** (-exponent))\n\n    def _parse_levels(self, data: bytes, offset: int) -> Tuple[List[Dict[str, float]], int]:\n        """\n        Parse one repeating group (asks or bids).\n        Layout:\n           uint16 blockLength\n           uint16 numInGroup\n           numInGroup * [ price(int64), size(int64) ] (within blockLength)\n        """\n        if offset + self.group_hdr_sz > len(data):\n            raise ValueError("insufficient data for group header")\n        block_len, num_in_group = struct.unpack_from(self.group_hdr_fmt, data, offset)\n        offset += self.group_hdr_sz\n\n        if block_len < self.level_sz:\n            raise ValueError(f"blockLength({block_len}) < level_sz({self.level_sz})")\n\n        levels = []\n        for _ in range(num_in_group):\n            if offset + block_len > len(data):\n                raise ValueError("insufficient data for group entry")\n            # we only care about first 16 bytes (price, size)\n            price_m, size_m = struct.unpack_from(self.level_fmt, data, offset)\n            offset += block_len  # skip the whole block (safe if future adds extra fields)\n\n            levels.append({\n                "price_m": price_m,\n                "size_m": size_m,\n            })\n        return levels, offset\n\n    # ---------------- public parse ----------------\n\n    def parse(self, data: bytes) -> Dict[str, Any]:\n        hdr = self._parse_header(data)\n        if hdr["template_id"] != self.target_template_id:\n            raise NotImplementedError(f"unsupported template_id={hdr[\'template_id\']}")\n\n        if len(data) < self.header_sz + self.body_sz:\n            raise ValueError("insufficient data for OBL50Event body")\n\n        # parse fixed body\n        (ts, seq, cts, u,\n         price_exp, size_exp, pkg_type) = struct.unpack_from(\n            self.body_fmt, data, self.header_sz\n        )\n\n        offset = self.header_sz + self.body_sz\n\n        # asks group\n        asks_raw, offset = self._parse_levels(data, offset)\n        # bids group\n        bids_raw, offset = self._parse_levels(data, offset)\n        # symbol\n        symbol, offset = self._parse_varstring8(data, offset)\n\n        # apply exponents\n        asks = [\n            {\n                "price": self._apply_exponent(l["price_m"], price_exp),\n                "size": self._apply_exponent(l["size_m"], size_exp),\n            }\n            for l in asks_raw\n        ]\n        bids = [\n            {\n                "price": self._apply_exponent(l["price_m"], price_exp),\n                "size": self._apply_exponent(l["size_m"], size_exp),\n            }\n            for l in bids_raw\n        ]\n\n        return {\n            "header": hdr,\n            "ts": ts,\n            "seq": seq,\n            "cts": cts,\n            "u": u,\n            "price_exponent": price_exp,\n            "size_exponent": size_exp,\n            "pkg_type": pkg_type,   # 0 = SNAPSHOT, 1 = DELTA\n            "symbol": symbol,\n            "asks": asks,\n            "bids": bids,\n            "parsed_length": offset,\n        }\n\n\nparser = SBEOBL50Parser()\n\n# -------------------------------------------------------------------\n# WebSocket handlers\n# -------------------------------------------------------------------\n\ndef on_message(ws, message):\n    try:\n        if isinstance(message, (bytes, bytearray)):\n            decoded = parser.parse(message)\n\n            pkg_type = decoded["pkg_type"]\n            pkg_str = "SNAPSHOT" if pkg_type == 0 else "DELTA" if pkg_type == 1 else f"UNKNOWN({pkg_type})"\n\n            asks = decoded["asks"]\n            bids = decoded["bids"]\n\n            best_ask = asks[0] if asks else {"price": 0.0, "size": 0.0}\n            best_bid = bids[0] if bids else {"price": 0.0, "size": 0.0}\n\n            logging.info(\n                "SBE %s u=%s seq=%s type=%s asks=%d bids=%d "\n                "BEST bid=%.8f@%.8f ask=%.8f@%.8f ts=%s",\n                decoded["symbol"], decoded["u"], decoded["seq"], pkg_str,\n                len(asks), len(bids),\n                best_bid["price"], best_bid["size"],\n                best_ask["price"], best_ask["size"],\n                decoded["ts"],\n            )\n\n            print(\n                f"{decoded[\'symbol\']}  u={decoded[\'u\']}  seq={decoded[\'seq\']}  {pkg_str}  "\n                f"levels: asks={len(asks)} bids={len(bids)}  "\n                f"BEST: bid {best_bid[\'price\']:.8f} x {best_bid[\'size\']:.8f}  |  "\n                f"ask {best_ask[\'price\']:.8f} x {best_ask[\'size\']:.8f}"\n            )\n\n        else:\n            # text frame: control / errors / ping-pong\n            try:\n                obj = json.loads(message)\n                logging.info("TEXT %s", obj)\n                print("TEXT:", obj)\n            except json.JSONDecodeError:\n                logging.warning("non-JSON text frame: %r", message)\n                print("TEXT(non-json):", message)\n    except Exception as e:\n        logging.exception("decode error: %s", e)\n        print("decode error:", e)\n\n\ndef on_error(ws, error):\n    print("WS error:", error)\n    logging.error("WS error: %s", error)\n\n\ndef on_close(ws, *_):\n    print("### connection closed ###")\n    logging.info("connection closed")\n\n\ndef ping_per(ws):\n    while True:\n        try:\n            ws.send(json.dumps({"op": "ping"}))\n        except Exception:\n            return\n        time.sleep(10)\n\n\ndef on_open(ws):\n    print("opened")\n    sub = {"op": "subscribe", "args": [TOPIC]}\n    ws.send(json.dumps(sub))\n    print("subscribed:", TOPIC)\n\n    # background ping thread\n    threading.Thread(target=ping_per, args=(ws,), daemon=True).start()\n\n\ndef on_pong(ws, *_):\n    print("pong received")\n\n\ndef on_ping(ws, *_):\n    print("ping received @", datetime.now().strftime("%Y-%m-%d %H:%M:%S"))\n\n\ndef connWS():\n    ws = websocket.WebSocketApp(\n        WS_URL,\n        on_open=on_open,\n        on_message=on_message,\n        on_error=on_error,\n        on_close=on_close,\n        on_ping=on_ping,\n        on_pong=on_pong,\n    )\n    ws.run_forever(ping_interval=20, ping_timeout=10)\n\n\nif __name__ == "__main__":\n    websocket.enableTrace(False)\n    connWS()\n\n')),(0,r.kt)("h3",{id:"golang"},"Golang"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'// sbe_ob50_client.go\npackage main\n\nimport (\n    "bytes"\n    "compress/flate"\n    "encoding/binary"\n    "encoding/json"\n    "fmt"\n    "log"\n    "math"\n    "time"\n\n    "github.com/gorilla/websocket"\n    "yourmodule/quote" // generated SBE package\n)\n\nconst (\n    WSURL   = "wss://stream.bybit.com/v5/market/sbe"\n    CHANNEL = "ob.50.sbe.BTCUSDT"\n)\n\nfunc toReal(mantissa int64, exponent int8) float64 {\n    return float64(mantissa) * math.Pow10(int(exponent))\n}\n\nfunc decodeOBL50(buf []byte) (*quote.OBL50Event, error) {\n    var hdr quote.MessageHeader\n    reader := bytes.NewReader(buf)\n\n    // decode messageHeader (little endian)\n    if err := binary.Read(reader, binary.LittleEndian, &hdr); err != nil {\n        return nil, fmt.Errorf("read header: %w", err)\n    }\n\n    if hdr.TemplateId != 20001 {\n        return nil, fmt.Errorf("unexpected templateId: %d", hdr.TemplateId)\n    }\n\n    var msg quote.OBL50Event\n    // many generators provide WrapForDecode; here assume we can read the fixed block then groups\n    if err := msg.Decode(reader, int(hdr.BlockLength), int(hdr.Version)); err != nil {\n        return nil, fmt.Errorf("decode OBL50: %w", err)\n    }\n\n    return &msg, nil\n}\n\nfunc main() {\n    book := NewOrderBook()\n\n    dialer := websocket.Dialer{\n        HandshakeTimeout: 10 * time.Second,\n        EnableCompression: false,\n    }\n\n    conn, _, err := dialer.Dial(WSURL, nil)\n    if err != nil {\n        log.Fatalf("dial: %v", err)\n    }\n    defer conn.Close()\n\n    // subscribe\n    sub := map[string]interface{}{\n        "op":   "subscribe",\n        "args": []string{CHANNEL},\n    }\n    if err := conn.WriteJSON(sub); err != nil {\n        log.Fatalf("subscribe: %v", err)\n    }\n\n    for {\n        mt, data, err := conn.ReadMessage()\n        if err != nil {\n            log.Fatalf("read: %v", err)\n        }\n\n        if mt == websocket.TextMessage {\n            // control JSON or pong etc\n            var m map[string]interface{}\n            _ = json.Unmarshal(data, &m)\n            continue\n        }\n\n        // if server wraps SBE in per-message deflate, you may need to decompress:\n        if isDeflatedFrame(data) {\n            data, err = inflate(data)\n            if err != nil {\n                log.Printf("inflate error: %v", err)\n                continue\n            }\n        }\n\n        msg, err := decodeOBL50(data)\n        if err != nil {\n            log.Printf("decode error: %v", err)\n            continue\n        }\n\n        u := msg.U\n        pkgType := msg.PkgType // 0 snapshot, 1 delta\n        pxExp := msg.PriceExponent\n        szExp := msg.SizeExponent\n\n        // extract levels\n        var asks, bids [][2]float64\n        for _, a := range msg.Asks {\n            p := toReal(a.Price, pxExp)\n            sz := toReal(a.Size, szExp)\n            asks = append(asks, [2]float64{p, sz})\n        }\n        for _, b := range msg.Bids {\n            p := toReal(b.Price, pxExp)\n            sz := toReal(b.Size, szExp)\n            bids = append(bids, [2]float64{p, sz})\n        }\n\n        // continuity logic:\n        if u == 1 {\n            // service restart / precision change snapshot\n            book.Asks.SnapshotFrom(asks)\n            book.Bids.SnapshotFrom(bids)\n            book.LastU = 1\n            fmt.Printf("[RESET SNAPSHOT] u=%d seq=%d symbol=%s\\n", u, msg.Seq, msg.Symbol)\n            continue\n        }\n\n        if book.LastU != 0 && u != book.LastU+1 {\n            log.Printf("[WARN] u jump: lastU=%d newU=%d \u2013 consider resync", book.LastU, u)\n        }\n\n        if pkgType == quote.PkgTypeEnum_SNAPSHOT {\n            book.Asks.SnapshotFrom(asks)\n            book.Bids.SnapshotFrom(bids)\n        } else {\n            for _, lv := range asks {\n                book.Asks.Apply(lv[0], lv[1])\n            }\n            for _, lv := range bids {\n                book.Bids.Apply(lv[0], lv[1])\n            }\n        }\n\n        book.LastU = u\n        bestBid := book.Bids.BestBid()\n        bestAsk := book.Asks.BestAsk()\n        fmt.Printf("u=%d pkgType=%d bestBid=%.5f bestAsk=%.5f\\n", u, pkgType, bestBid, bestAsk)\n    }\n}\n\n// helpers (optional, depending on ws framing)\nfunc isDeflatedFrame(data []byte) bool {\n    // placeholder: detect by protocol; many setups know from WS sub-protocol\n    return false\n}\n\nfunc inflate(data []byte) ([]byte, error) {\n    r := flate.NewReader(bytes.NewReader(data))\n    defer r.Close()\n\n    var out bytes.Buffer\n    if _, err := out.ReadFrom(r); err != nil {\n        return nil, err\n    }\n    return out.Bytes(), nil\n}\n')))}m.isMDXComponent=!0}}]);